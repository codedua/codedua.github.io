<!DOCTYPE html>
<html lang="en">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta
    name="description"
    content=""
  />
  
    
      <title>WebGL | codedua</title>
    
  
  <link rel="stylesheet" href="/css/reset.css"/>
  <link rel="stylesheet" href="/css/font.css"/>
  <link rel="stylesheet" href="/css/smigle.css"/>
  
  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="images/icon_coconut_32px.png">
  <link rel="icon" type="image/png" sizes="16x16" href="images/icon_coconut_16px.png">
  <link rel="manifest" href="/site.webmanifest">
  <link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#da532c">
  <meta name="theme-color" content="#ffffff">
</head>

  <body>
    <div id="root">

      
        <header>
  <div id="brand">
    <a class="icon-link" href="http://localhost:1313/">
      <img
        class="icon"
        src="/images/icon_coconut_512px.png"
      />
    </a>
    <div class="text">
      <a href="http://localhost:1313/"><h1>codedua</h1></a>
      <h3>my technote</h3>
    </div>
  </div>
  <nav>
    
  </nav>
  <hr />
</header>

      

      <div id="content">
        
  <main>
    <article>
      <h1 class="title">WebGL</h1>
      
      <div class="post-meta">
  <strong>
    <span>Posted on</span>
    <time>2024-08-29</time>
    
    
  </strong>
  <span> â€¢ 1163 words</span>
  <span> â€¢ 6 minute read</span>
  
  
</div>

      <div class="content"><hr>
<p>CÃ³ 2 cÃ¡ch Ä‘á»ƒ truyá»n 1 giÃ¡ trá»‹ vÃ o shader:</p>
<ul>
<li>Uniform: Ä‘á»ƒ pass data giá»‘ng nhau (uniform) cho cÃ¡c Ä‘á»‰nh vertex.</li>
<li>Attribute: Ä‘á»ƒ pass data khÃ¡c nhau cho tá»«ng Ä‘á»‰nh vertex</li>
</ul>
<h3 id="attribute">Attribute</h3>
<p>Attribute variable lÃ  má»™t biáº¿n GLSL ES Ä‘á»ƒ pass data tá»« outside vÃ o shader vÃ  chá»‰ available trong vertex shader. CÃ¡c bÆ°á»›c Ä‘á»ƒ truyá»n data tá»« bÃªn ngoÃ i shader (tá»« file javascript) vÃ o shader sá»­ dá»¥ng attribute:</p>
<ol>
<li>Tá»« phÃ­a vertex shader, declare má»™t attribute (vÃ  dÃ¹ng nÃ³)
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span>attribute vec4 a_Position;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>    gl_Position <span style="color:#f92672">=</span> a_Position;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>Tá»« phÃ­a js, get attribute variable vá»«a Ä‘Æ°á»£c khai bÃ¡o trong vertext shader
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">a_Position</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getAttribLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#39;a_Position&#39;</span>);
</span></span></code></pre></div><ul>
<li>program: program object that holds vertex shader and fragment shader</li>
<li>a_Position: tÃªn cá»§a attribute trong vertex shader muá»‘n get</li>
</ul>
</li>
<li>set value cho attribute variable vá»«a get:<br>
bÆ°á»›c nÃ y sáº½ pass value data vÃ o attribute trong vertext shader
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">vertexAttrib3f</span>(<span style="color:#a6e22e">a_Position</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">0.0</span>);
</span></span></code></pre></div><ul>
<li>3 tham sá»‘ cuá»‘i: giÃ¡ trá»‹ muá»‘n truyá»n cho attribute. TrÆ°á»ng há»£p nÃ y attribute trong vertex shader lÃ  vec4 thÃ¬ giÃ¡ trá»‹ thá»© 4 sáº½ máº·c Ä‘á»‹nh lÃ  1.0.<br>
ngoÃ i ra cÃ³ thá»ƒ sá»­ dá»¥ng gl.vertexAttrib4f(a_Position, 0.0, 0.0, 0.0, 0.0) Ä‘á»ƒ tá»± tay set cáº£ 4 giÃ¡ trá»‹ cho attribute vec4 a_Position
hoáº·c dÃ¹ng gl.vertexAttrib2f(, , ,) hay vertexAttrib1f(, ,) Ä‘á»ƒ set giÃ¡ trá»‹ cho attribute cÃ³ kiá»ƒu vec2 hoáº·c vec1</li>
</ul>
</li>
</ol>
<h3 id="uniform">Uniform</h3>
<p>Biáº¿n attribute chá»‰ sá»­ dá»¥ng Ä‘Æ°á»£c trong vertex shader, Ä‘á»ƒ truyá»n data tá»« ngoÃ i vÃ o fragment shader thÃ¬ cáº§n sá»­ dá»¥ng biáº¿n uniform. Uniform cÃ³ thá»ƒ truyá»n data tá»« Javascript program tá»›i cáº£ vertex shader vÃ  fragment shader. (NgoÃ i ra cÃ³ thá»ƒ dÃ¹ng biáº¿n varying). Äá»ƒ truyá»n data vÃ o shader thÃ´ng qua uniform, cÃ¡c bÆ°á»›c tÆ°Æ¡ng tá»± nhÆ° dÃ¹ng attribute:</p>
<ol>
<li>Tá»« phÃ­a shader, declare má»™t uniform (vÃ  dÃ¹ng nÃ³)
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-c" data-lang="c"><span style="display:flex;"><span>precision mediump <span style="color:#66d9ef">float</span>;
</span></span><span style="display:flex;"><span>uniform vec4 u_FragColor;
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">main</span>() { 
</span></span><span style="display:flex;"><span>    gl_FragColor <span style="color:#f92672">=</span> u_FragColor;
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div></li>
<li>Tá»« phÃ­a chÆ°Æ¡ng trÃ¬nh javascript, get uniform trong shader
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">var</span> <span style="color:#a6e22e">u_FragColor</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">getUniformLocation</span>(<span style="color:#a6e22e">program</span>, <span style="color:#e6db74">&#39;u_FragColor&#39;</span>); 
</span></span></code></pre></div></li>
<li>set value cho uniform vá»«a get Ä‘Æ°á»£c:
bÆ°á»›c nÃ y sáº½ truyá»n data vÃ o uniform trong shader
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">gl</span>.<span style="color:#a6e22e">uniform4f</span>(<span style="color:#a6e22e">u_FragColor</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">1.0</span>, <span style="color:#ae81ff">0.0</span>, <span style="color:#ae81ff">1.0</span>); 
</span></span></code></pre></div></li>
</ol>
<p>ngoÃ i ra, cÃ³ cÃ¡c method khÃ¡c Ä‘á»ƒ set value cho uniform:<br>
gl.uniform1f(uniform_variable, value)<br>
gl.uniform2f(uniform_variable, value1, value2)<br>
gl.uniform3f(uniform_variable, value1, value2, value3)</p>
<hr>
<h3 id="register-event-handler-in-js">Register event handler in js</h3>
<p>sá»­ dá»¥ng cÃº phÃ¡p function anonymous Ä‘á»ƒ Ä‘Äƒng kÃ­ má»™t handler cho má»™t event nÃ o Ä‘Ã³:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">function</span>() { 
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// body
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} 
</span></span></code></pre></div><p>hoáº·c</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span>( () =&gt; {
</span></span><span style="display:flex;"><span>    <span style="color:#75715e">// Body...
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>} )();
</span></span></code></pre></div><p>má»™t event handler (gá»i táº¯t lÃ  má»™t handler) lÃ  má»™t async callback function sáº½ Ä‘Æ°á»£c gá»i khi má»™t event nÃ o Ä‘Ã³ diá»…n ra nhÆ° click chuá»™t, báº¥m phÃ­m&hellip;<br>
<code>&lt;canvas&gt;</code> phÃ¢n loáº¡i event thÃ´ng qua cÃ¡c property. vÃ­ dá»¥ <code>canvas.onmousedown</code> chá»‰ Ä‘á»‹nh event click chuá»™t. ta Ä‘Äƒng kÃ­ má»™t handler cho event nÃ y nhÆ° sau:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">onmousedown</span> <span style="color:#f92672">=</span> <span style="color:#66d9ef">function</span>(<span style="color:#a6e22e">ev</span>) {
</span></span><span style="display:flex;"><span>                        <span style="color:#75715e">// define nhá»¯ng gÃ¬ sáº½ xáº£y ra khi click chuá»™t
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>                     }                 
</span></span></code></pre></div><ul>
<li>ev: an event object that contains information about the mouse press.<br>
<em><a href="https://developer.mozilla.org/en-US/docs/Web/API/Element/mousedown_event">https://developer.mozilla.org/en-US/docs/Web/API/Element/mousedown_event</a></em></li>
</ul>
<hr>
<h3 id="buffer-object">Buffer object</h3>
<p>Buffer object lÃ  má»™t vÃ¹ng nhá»› lÆ°u trá»¯ Ä‘Æ°á»£c nhiá»u Ä‘á»‰nh (vertex) Ä‘Æ°á»£c cung cáº¥p bá»Ÿi há»‡ thá»‘ng WebGL. Buffer object Ä‘Æ°á»£c dÃ¹ng lÃ m nÆ¡i lÆ°u trá»¯ dá»¯ liá»‡u cÃ¡c Ä‘á»‰nh vá»«a lÃ  cÃ¡ch Ä‘á»ƒ truyá»n dá»¯ liá»‡u cÃ¡c Ä‘á»‰nh (tá»a Ä‘á»™ cÃ¡c Ä‘á»‰nh) tá»›i vertex shader má»™t cÃ¡ch Ä‘á»“ng thá»i (simutaneously).<br>
â“Táº¡i sao cáº§n truyá»n dá»¯ liá»‡u tá»a Ä‘á»™ cá»§a cÃ¡c Ä‘á»‰nh tá»›i vertex shader má»™t cÃ¡c Ä‘á»“ng thá»i?<br>
Táº¡i vÃ¬ náº¿u chá»‰ truyá»n dá»¯ liá»‡u 1 Ä‘á»‰nh tá»›i vertex shader thÃ¬ nÃ³ chá»‰ váº½ Ä‘á»‰nh Ä‘Ã³ 1 láº§n. trong vÃ­ dá»¥ báº¯t event click chuá»™t Ä‘á»ƒ váº½ 1 Ä‘iá»ƒm á»Ÿ vá»‹ trÃ­ click chuá»™t. dÃ¹ ta váº½ Ä‘Æ°á»£c nhiá»u Ä‘iá»ƒm trÃªn canvas nhÆ°ng má»—i Ä‘iá»ƒm Ä‘Ã³ Ä‘Æ°á»£c truyá»n vÃ o vertex shader má»™t cÃ¡ch riÃªng láº» sau cÃº click chuá»™t. <del>tuy nhiÃªn, náº¿u truyá»n cáº£ 3 Ä‘á»‰nh vÃ o vertex shader cÃ¹ng má»™t lÃºc thÃ¬ (cháº¯c lÃ ) nÃ³ váº½ cáº£ 3 Ä‘á»‰nh cÃ¹ng lÃºc 1 cÃ¡ch thá»±c sá»± (cháº¯c lÃ  liÃªn quan Ä‘áº¿n tháº¿ máº¡nh GPU cÃ³ nhiá»u core vÃ  run parallelğŸ’©ğŸ˜).</del><br>
má»—i Ä‘á»‰nh Ä‘Æ°á»£c truyá»n vÃ o vertex shader lÃ  vertex shader Ä‘Æ°á»£c executed 1 láº§n vÃ  váº½ ra 1 Ä‘iá»ƒm trÃªn canavs</p>
<p>Steps to pass multiple data values to a vertex shader through a buffer object:</p>
<p><img src="/images/webgl-steps-pass-multi-ver-to-shader.png" alt=""></p>
<ol>
<li>
<p>Create a buffer object<br>
<code> var vertexBuffer = gl.createBuffer();</code>
DÆ°á»›i Ä‘Ã¢y lÃ  internal state ban Ä‘áº§u cá»§a webGL:<br>
<img src="/images/webgl-internal-state.png" alt="">
Sau khi táº¡o má»™t buffer object:
<img src="/images/webgl-internal-state1.png" alt=""></p>
</li>
<li>
<p>Bind buffer object tá»›i má»™t target<br>
target cho webGL biáº¿t datatype cá»§a buffer object.<br>
<code> gl.bindBuffer(gl.ARRAY_BUFFER, vertexBuffer);</code></p>
<ul>
<li>1st param: target
<ul>
<li>gl.ARRAY_BUFFER: buffer chá»©a cÃ¡c vertex data (thuá»™c tÃ­nh liÃªn quan Ä‘áº¿n vertex) nhÆ° tá»a Ä‘á»™ Ä‘á»‰nh, tá»a Ä‘á»™ texture, mÃ u sáº¯c Ä‘á»‰nh</li>
<li>gl.ELEMENT_ARRAY_BUFFER: buffer chá»©a cÃ¡c index trá» tá»›i vertex data<br>
&hellip;</li>
</ul>
</li>
<li>2nd param: buffer object Ä‘á»ƒ bind
<img src="/images/webgl-internal-state2.png" alt=""></li>
</ul>
</li>
<li>
<p>Ghi data vÃ o buffer object<br>
<code> gl.bufferData(gl.ARRAY_BUFFER, vertices, gl.STATIC_DRAW);</code><br>
<img src="/images/webgl-internal-state3.png" alt=""></p>
</li>
<li>
<p>Truyá»n buffer object vÃ o vertex shader thÃ´ng qua má»™t attribute variable
<code>gl.vertexAttribPointer(a_Position, 2, gl.FLOAT, false, 0, 0); </code>
vÃ­ dá»¥ attribute variable á»Ÿ Ä‘Ã¢y lÃ  <code>a_Position</code><br>
TÆ°Æ¡ng tá»± khi ta dÃ¹ng attribute Ä‘á»ƒ truyá»n má»™t data tá»« ngoÃ i vÃ o shader, ta dÃ¹ng method vertexAttrib4f(). Tuy nhiÃªn method nÃ y chá»‰ truyá»n Ä‘Æ°á»£c má»™t data Ä‘Æ¡n láº» (dá»¯ liá»‡u cá»§a 1 Ä‘á»‰nh) vÃ o shader. Trong khi Ä‘Ã³, ta Ä‘ang muá»‘n truyá»n 1 buffer chá»©a nhiá»u data (dá»¯ liá»‡u cá»§a nhiá»u Ä‘á»‰nh) vÃ o shader nÃªn ta dÃ¹ng method vertexAttribPointer().<br>
NhÆ° tÃªn cá»§a method, thá»±c táº¿ ta chá»‰ truyá»n má»™t tham chiáº¿u (pointer) cá»§a buffer object vÃ o vertex shader.</p>
<ul>
<li>1st param: attribute location (lÃ  attribute trong shader mÃ  ta Ä‘Ã£ dÃ¹ng js Ä‘á»ƒ get trÆ°á»›c Ä‘Ã³)</li>
<li>2nd param: giÃ¡ trá»‹ tá»« 1 Ä‘áº¿n 4, tÆ°Æ¡ng tá»± nhÆ° vertexAttrib1f hoáº·c vertexAttrib2f, vertexAttrib3f, vertexAttrib4f. Trong trÆ°á»ng há»£p nÃ y, vertex data ta truyá»n vÃ o chá»‰ lÃ  tá»a Ä‘á»™ (x,y) cá»§a Ä‘iá»ƒm nÃªn ta truyá»n vÃ o 2.</li>
<li>3rd param: datatype</li>
<li>4th param:</li>
<li>5th param: sá»‘ bytes giá»¯a cÃ¡c vertex data elements trong buffer (giá»¯a cÃ¡c pháº§n tá»« trong array). default = 0</li>
<li>6th param: offset. chá»‰ ra data element Ä‘áº§u tiÃªn Ä‘Æ°á»£c lÆ°u báº¯t Ä‘áº§u tá»« byte thá»© máº¥y trong buffer. default = 0</li>
</ul>
<p><img src="/images/webgl-internal-state4.png" alt=""></p>
</li>
<li>
<p>KÃ­ch hoáº¡t vertex attribute<br>
<code>gl.enableVertexAttribArray(a_Position); </code>
sau khi Ä‘Ã£ truyá»n data tá»« ngoÃ i (tá»« 1 buffer object bÃªn ngoÃ i shader) vÃ o shader, cáº§n enable nÃ³. ğŸ’© loáº±ng ngoáº±ng vl
<img src="/images/webgl-internal-state5.png" alt=""></p>
</li>
</ol>
<p>bá»Ÿi vÃ¬ (ta truyá»n má»™t buffer chá»©a 3 data cá»§a 3 Ä‘á»‰nh vÃ ) ta yÃªu cáº§u váº½ 3 point trÃªn canvas dá»±a vÃ o 3 data trong buffer Ä‘Ã³ <code>gl.drawArrays(gl.POINTS, 0, 3);</code> nÃªn vertex shader Ä‘Æ°á»£c executed 3 láº§n
<img src="/images/webgl-internal-state-full.png" alt=""></p>
<hr>
<h3 id="apis">APIs</h3>
<p>webGL lÃ  má»™t javascript library cung cáº¥p kháº£ nÄƒng render Ä‘á»“ há»a 2D 3D trÃªn trÃ¬nh duyá»‡t web vÃ  cÃ³ thá»ƒ tÆ°Æ¡ng tÃ¡c mÃ  khÃ´ng cáº§n sá»­ dá»¥ng báº¥t cá»© plugin gÃ¬.<br>
Táº¥t cáº£ API cá»§a lib webgl Ä‘Æ°á»£c exposed thÃ´ng qua WebGLRenderingContext. VÃ  ta cÃ³ thá»ƒ dÃ¹ng API cá»§a nÃ³ Ä‘á»ƒ váº½ Ä‘á»“ há»a lÃªn <code>&lt;canvas&gt;</code> element cá»§a HTML. VÃ¬ váº­y Ä‘á»ƒ sá»­ dá»¥ng API cá»§a nÃ³, trong code js ta cáº§n getContext(&lsquo;webgl&rsquo;)</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-js" data-lang="js"><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">canvas</span> <span style="color:#f92672">=</span> document.<span style="color:#a6e22e">getElementById</span>(<span style="color:#e6db74">&#34;myCanvas&#34;</span>);
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">const</span> <span style="color:#a6e22e">gl</span> <span style="color:#f92672">=</span> <span style="color:#a6e22e">canvas</span>.<span style="color:#a6e22e">getContext</span>(<span style="color:#e6db74">&#34;webgl&#34;</span>);
</span></span></code></pre></div><ul>
<li>createProgram(): create vÃ  init má»™t webGLProgram object</li>
</ul>
<h4 id="webglshader">webGLShader</h4>
<p>LÃ  má»™t object Ä‘Æ°á»£c constructed tá»« vertex shader hoáº·c fragment shader</p>
<h4 id="webglprogram">webGLProgram</h4>
<p>lÃ  má»™t object. káº¿t há»£p cá»§a 2 webGLShader. 2 webGLShader Ä‘Ã£ Ä‘Æ°á»£c compile Ä‘Æ°á»£c liÃªn káº¿t vÃ o má»™t webGLProgram</p>
</div>
    </article>
  </main>

      </div>

      
        <footer>
  <hr />

  <style>
    .small-block {
      font-size: 12px;  
    }
  </style>
  <div class="small-block">
    <p class="copyright">
      Copyright Â© 2024
      <a href="http://localhost:1313/"><strong>codedua</strong></a>.
      This work is licensed under the
      <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a> license.
    </p>
    <p class="builtWith">
      Built with
      <a href="http://www.gohugo.io/">Hugo</a>,
      using the theme
      <a href="https://gitlab.com/ian-s-mcb/smigle-hugo-theme">smigle</a>,
      which was influenced by the theme
      <a href="https://github.com/sumnerevans/smol">smol</a>.
    </p>
  </div>
</footer>

      
    </div>
  </body>
</html>
